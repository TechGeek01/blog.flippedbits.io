<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.73.0 with theme Tranquilpeak 0.4.8-BETA"><meta name=author content="Andy Yasger"><meta name=keywords content><meta name=description content="When moving from Pi-hole to pfBlockerNG, it can be a bit confusing, so I wanted to clarify some things about how this works."><meta property="og:description" content="When moving from Pi-hole to pfBlockerNG, it can be a bit confusing, so I wanted to clarify some things about how this works."><meta property="og:type" content="article"><meta property="og:title" content="Wrangling DNS on Your Network, Part 3: pfBlockerNG"><meta name=twitter:title content="Wrangling DNS on Your Network, Part 3: pfBlockerNG"><meta property="og:url" content="https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><meta property="twitter:url" content="https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><meta property="og:site_name" content="FlippedBits.io"><meta property="og:description" content="When moving from Pi-hole to pfBlockerNG, it can be a bit confusing, so I wanted to clarify some things about how this works."><meta name=twitter:description content="When moving from Pi-hole to pfBlockerNG, it can be a bit confusing, so I wanted to clarify some things about how this works."><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2020-07-06T00:00:00"><meta property="article:modified_time" content="2020-07-06T00:00:00"><meta property="article:section" content="Networking"><meta property="article:section" content="DNS"><meta property="article:section" content="Tutorials"><meta property="article:tag" content="network"><meta property="article:tag" content="dns"><meta property="article:tag" content="pfsense"><meta property="article:tag" content="pihole"><meta property="article:tag" content="adblock"><meta name=twitter:card content="summary"><meta property="og:image" content="https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/header.png"><meta property="twitter:image" content="https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/header.png"><meta property="og:image" content="https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/header.png"><meta property="twitter:image" content="https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/header.png"><meta property="og:image" content="https://blog.flippedbits.io/img/profile.jpg"><meta property="twitter:image" content="https://blog.flippedbits.io/img/profile.jpg"><title>Wrangling DNS on Your Network, Part 3: pfBlockerNG</title><link rel=icon href=https://blog.flippedbits.io/favicon.png><link rel=canonical href=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin=anonymous><link rel=stylesheet href=https://blog.flippedbits.io/css/style-4esn1kmdyrc91phnvdi1zgn9saxvg5nhngxszpldffxrjlmep9ktolhwe1.min.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-170794764-1','auto');ga('send','pageview');}</script></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=https://blog.flippedbits.io/>FlippedBits.io</a></div><a class=header-right-picture href=https://blog.flippedbits.io/#about><img class=header-picture src=https://blog.flippedbits.io/img/profile.jpg alt="Author's picture"></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=https://blog.flippedbits.io/#about><img class=sidebar-profile-picture src=https://blog.flippedbits.io/img/profile.jpg alt="Author's picture"></a><h4 class=sidebar-profile-name>Andy Yasger</h4><h5 class=sidebar-profile-bio>&ldquo;My documentation is <em><strong>in</strong></em> the code!&rdquo;</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://blog.flippedbits.io/><i class="sidebar-button-icon fa fa-lg fa-home"></i><span class=sidebar-button-desc>Home</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.flippedbits.io/categories><i class="sidebar-button-icon fa fa-lg fa-bookmark"></i><span class=sidebar-button-desc>Categories</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.flippedbits.io/tags><i class="sidebar-button-icon fa fa-lg fa-tags"></i><span class=sidebar-button-desc>Tags</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.flippedbits.io/archives><i class="sidebar-button-icon fa fa-lg fa-archive"></i><span class=sidebar-button-desc>Archives</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.flippedbits.io/page/about-me><i class="sidebar-button-icon fa fa-lg fa-question"></i><span class=sidebar-button-desc>About Me</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/TechGeek01 target=_blank rel=noopener><i class="sidebar-button-icon fa fa-lg fa-github"></i><span class=sidebar-button-desc>GitHub</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://blog.flippedbits.io/index.xml><i class="sidebar-button-icon fa fa-lg fa-rss"></i><span class=sidebar-button-desc>RSS</span></a></li></ul></div></nav><div class="post-header-cover
text-center
post-header-cover--partial" style=background-image:url(/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/header.png) data-behavior=4></div><div id=main data-behavior=4 class="hasCover
hasCoverMetaOut"><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class="post-header main-content-wrap text-center"><h1 class=post-title itemprop=headline>Wrangling DNS on Your Network, Part 3: pfBlockerNG</h1><div class="postShorten-meta post-meta"><time itemprop=datePublished datetime=2020-07-06T00:00:00Z>July 6, 2020</time>
<span>in</span>
<a class=category-link href=https://blog.flippedbits.io/categories/networking>Networking</a>,
<a class=category-link href=https://blog.flippedbits.io/categories/dns>DNS</a>,
<a class=category-link href=https://blog.flippedbits.io/categories/tutorials>Tutorials</a></div></div><div class="post-content markdown" itemprop=articleBody><div class=main-content-wrap><div class="alert info"><p>This is part of a multi-part series on DNS. Part 4 will be coming soon!</p></div><p>Everyone loves adblock, myself included, so of course I set up a Pi-hole a while ago. It does so much more than just regular old browser-based adblock does, because there&rsquo;s no option to block ads with a browser extension in things like Android apps.</p><p>But now that we have this set up, you might be wondering if there&rsquo;s another way. After all, in a homelab environment, of course everyone always wants to screw with things. Well, you&rsquo;d be right. Conveniently, pfSense has a package called pfBlockerNG, that aims to basically do something like Pi-hole. It&rsquo;s not strictly for ad-blocking, but rather for general purpose DNS filtering.</p><p>As you can imagine, this makes it a lot more powerful than Pi-hole, but it also means there&rsquo;s a lot more of a learning curve.</p><p>We&rsquo;ve already set up Pi-hole, so if all you&rsquo;re looking for is DNS adblock, and the pfSense DNS for local hostnames, you&rsquo;re all set, and it&rsquo;s a perfect spot for you to stop. If, however, you want a more powerful tool than Pi-hole, this part in the series tackles that.</p><p>So, will you take the <span class="highlight-text red">red pill</span>, and dive into the rabbit hole, or will you take the <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">blue pill</a> and remain in blissful ignorance?</p><h2 id=installing-pfblockerng>Installing pfBlockerNG</h2><p>pfBlockerNG is a package for pfSense, so naturally, it&rsquo;s under <strong>System > Package Manager</strong>. When you search for it, you&rsquo;ll see something like this:</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfsense-package-choices.png alt="There's two separate versions here"><span class=caption>There's two separate versions here</span></div><div class=main-content-wrap><p>Your two choices for installing are what looks like a normal version, and a development version. Here&rsquo;s the thing: that&rsquo;s not quite right. The <code>devel</code> version is very much stable, and is basically a rewrite of the UI that makes everything easier to work with. Because of this, we&rsquo;re going to be installing the <code>devel</code> version, which I&rsquo;d recommend you also do. If, however, you&rsquo;re a masochist, the layout will be a bit different for you, and it may be harder to follow along here.In any case, click install, wait for it to do its thing, and it&rsquo;ll set everything up.</p><div class="alert info"><p><p>It should be noted that at the time of writing, the main package is v2.1.4_22, and the <code>devel</code> package is v2.2.5_33.</p><p>BBCan177 has told me that the plan is for <code>devel</code> to become the main version sometime hopefully soon, so if you&rsquo;re reading this in the future, the main package might not be as masochistic.</p></p></div><p>Now, I know what you&rsquo;re thinking:</p><blockquote class=pullquote><p>I know how this goes! We did this with Pi-hole. Now that we installed everything, we're done!</p></blockquote><p>Well, not exactly. pfBlockerNG isn&rsquo;t an out of the box ad-block tool. It&rsquo;s a filtering tool that leverages the pfSense firewall, so out of the box, we get nothing. We still have quite a bit of setup to do before we&rsquo;re done.</p><p>Navigate your way to <strong>Firewall > pfBlockerNG</strong> and it&rsquo;ll present you with a fancy-looking wizard to help get started.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-wizard-00.png></div><div class=main-content-wrap><p>There&rsquo;s nothing to do here, so click <span class="highlight-text primary">Next</span>.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-wizard-01.png></div><div class=main-content-wrap><p>It&rsquo;ll warn you about some stuff with a pretty serious looking disclaimer. If you&rsquo;ve installed pfBlockerNG previously, this wizard is gonna blow out those settings.</p><p>pfBlockerNG works in two parts. There&rsquo;s a DNS block list, referred to as DNSBL, which is going to be used like we did with the Pi-hole. This leverages the existing DNS Resolver that we&rsquo;re already using to handle this blocking of things!</p><p>Anyway, there&rsquo;s again, nothing to change just yet, so hit <span class="highlight-text primary">Next</span> again.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-wizard-02.png></div><div class=main-content-wrap><blockquote class=pullquote><p>Whoa, whoa, whoa! Pi-hole was way easier to set up than this! What the heck is this big scary thing‽</p></blockquote><p>Depending on your VLAN setup, this list can look a little scary, and this window seems kind of intimidating anyway. For a basic setup, the default options for WAN for inbound, and LAN for outbound, are okay. If, however, you have a VLAN setup, or have other interfaces you want to work with, you&rsquo;ll want to change them accordingly. Since I&rsquo;m running with VLANs, I chose my <span class="highlight-text primary">End Devices</span> and <span class="highlight-text primary">IoT</span> VLAN interfaces in place of LAN for the outbound.</p><p>Unless you have a weird dual-WAN setup, or some other edge case, you can leave inbound alone. Click <span class="highlight-text primary">Next</span> to keep on going.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-wizard-03.png></div><div class=main-content-wrap><p>Next, it&rsquo;s gonna ask for a few more things. To handle the listening of the DNSBL connections, it needs to set up its own web server. This is not a thing we ran into with Pi-hole, because I believe it just redirects to 0.0.0.0.</p><p>In the case of pfBlockerNG, it&rsquo;s going to prompt us for this, and dedicate a proper blackhole address. Make this VIP address something you&rsquo;re not using on your network, because if this address is used elsewhere, you&rsquo;re gonna have some problems.</p><p>Unless you&rsquo;re using the default ports of 8081 and 8443 for something else there, leave those as default. Click <span class="highlight-text primary">Next</span> to move to the last step.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-wizard-04.png></div><div class=main-content-wrap><p>Okay, I lied. It&rsquo;s not really a step. More disclaimers about what&rsquo;s gonna happen, because you&rsquo;re gonna click things, and get a big scary window, and if you don&rsquo;t know what it is, it might freak you out a bit. There&rsquo;s a <span class="highlight-text primary">Finish</span> button, and I think you guys know the drill by now.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-wizard-update.png></div><div class=main-content-wrap><p>Anyway, when you&rsquo;re done, you&rsquo;re gonna see this big scary thing, and it&rsquo;s got a lot of stuff on it, and it&rsquo;s probably freaking you out a bit.</p><p>Normally, you&rsquo;d hop over here to manually update, or to check status. This usually runs on a cron job. We just finished, and there needs to be an initial update, so there is no cron job. It may look like that&rsquo;s broken, but that&rsquo;s what you&rsquo;re gonna see for &ldquo;Status&rdquo; the first time.</p><p>You&rsquo;re going to be tempted to click <span class="highlight-text primary">Run</span>. Don&rsquo;t do that. It&rsquo;ll kick off an automatic update the first time because it can&rsquo;t function without the data, so let it do its thing. You&rsquo;ll notice there&rsquo;s a log at the bottom that&rsquo;s spitting out a bunch of scary-looking information, and it&rsquo;s gonna do its thing for a bit, and grab some lists, and the latest updates, and when it&rsquo;s all done, you&rsquo;ll see this at the bottom.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-wizard-update-done.png></div><div class=main-content-wrap><h2 id=grabbing-the-lists>Grabbing the lists</h2><blockquote class=pullquote><p>Cool! So we installed everything, and ran the wizard. Now that we did that, everything should work, and we're all set, right?</p></blockquote><p>Yeah, no. As much as you probably don&rsquo;t want me to tell you this, we&rsquo;re just getting started. pfBlockerNG is now installed, and configured properly after the initial setup. To get it to replace Pi-hole, however, we have to do some setup of some DNSBL lists.</p><p>And yes, I know you didn&rsquo;t have to do any of that stuff with Pi-hole, and it just did it for you. I know this all seems really complicated, and it&rsquo;s a lot more work than you were expecting, but the payoff is worth it for a tool that can do a whole lot more, and it&rsquo;s really not all that bad. It&rsquo;s a lot more involved to set up, but it&rsquo;s relatively intuitive, as you might have noticed by now.</p><p>Click your way over to the <strong>General</strong> tab. You should see both the <strong>Enable pfBlockerNG</strong> and <strong>Keep Settings</strong> boxes are both checked.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-general.png></div><div class=main-content-wrap><p>Feel free to explore more of these settings in the mean time. When you&rsquo;re done, hop on over to the <strong>DNSBL</strong> tab, and you&rsquo;ll see something like this:</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-dnsbl.png></div><div class=main-content-wrap><p><strong>DNSBL</strong> should be enabled up at the top. If it&rsquo;s not for some reason, enable it.</p><div class="alert info"><p>The <strong>DNSBL Webserver Configuration</strong> is where you&rsquo;ll find the same settings we saw in the wizard. If you need to change the ports the block page runs on, or the virtual IP it uses, you can do that here.</p></div><p>Once DNSBL is enabled and we know it&rsquo;s all set, it&rsquo;s finally time to grab our block lists! Click on the <strong>Feeds</strong> tab. There&rsquo;s a lot of lists here, as you can tell, maintained by a lot of different people. The ones with a check by them are enabled and configured, and the ones with the + are ones we can add.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-feeds.png alt="There's a ton of feed lists here we can choose from!"><span class=caption>There's a ton of feed lists here we can choose from!</span></div><div class=main-content-wrap><p>Notice how there&rsquo;s a category on top for IPv4. If you scroll down a bit, you&rsquo;ll find IPv6 as well. Just past IPv6, you&rsquo;ll find a DNSBL category, which is the one we&rsquo;re looking for.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/feeds-dnsbl.png alt="Notice the checkmarks"><span class=caption>Notice the checkmarks</span></div><div class=main-content-wrap><p>If you notice, EasyList has a check mark on the left hand side, right by the info icon. This tells you that the list itself already exists. You&rsquo;ll also notice on the right side, that EasyList and EasyPrivacy have check marks as well, which indicate that those specific feeds have been enabled.</p><p>It&rsquo;s important to note here, that depending on your resources in pfSense, you might not want to enable a ton of lists, as having a lot enabled can potentially slow down your firewall. If you&rsquo;re on a system with less resources, particularly in RAM, you need to be careful here. Add lists slowly, and keep an eye on memory and CPU usage and such.</p><p>Scroll down in the DNSBL list until you see the <strong>BBcat177</strong> category, and click the + on the left of the category.</p><p>Normally, from here, you can toggle individual lists with the second gray drop down that shows as <strong>OFF</strong> at the moment. For this single list, we could toggle that to <strong>ON</strong>, or, to update the whole list, we can click <span class="highlight-text primary">Enable All</span> at the bottom. This will enable the entire group. Also make sure you change the <strong>Action</strong> in the settings group to <strong>Unbound</strong> which will make sure DNS blocking gets properly enabled for the group.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/dnsbl-group-bbcat177.png></div><div class=main-content-wrap><p>Once you&rsquo;ve enabled everything in the list, and changed the action to Unbound, scroll to the bottom and click <span class="highlight-text primary">Save</span>. You can repeat this process for each list or feed you want to add. If all of this went according to plan, clicking the <strong>DNSBL Groups</strong> tab to bring you to the group list should look like this.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/dnsbl-groups.png></div><div class=main-content-wrap><p>As long as we&rsquo;re messing with feeds, I&rsquo;d also recommend enabling the <strong>Cryptojackers</strong> list. You&rsquo;ll have to go back to the <strong>Feeds</strong> tab to do so, though. If you ever notice any problems with your domains, and there&rsquo;s something you can&rsquo;t get to that you should be able to, you&rsquo;ll have to tweak some of the lists, and add exceptions.</p><p>Doing this is easy enough. If you notice a domain is being blocked that shouldn&rsquo;t be, head over to the <strong>Reports</strong> tab, and click the little + next to the domain in question to add it to the whitelist.</p><div class="alert info"><p><p>Someone on the Pi-hole forums has compiled a <a href=https://raw.githubusercontent.com/raghavdua1995/DNSlock-PiHole-whitelist/master/whitelist.list>custom whitelist</a> for the things that Pi-hole whitelists by default. It&rsquo;s not strictly necessary, and I find you have a lot more control by whitelisting things manually, but if you want to add this list to the whitelist, you can.</p><p>To do so, in the <strong>DNSBL</strong> tab, click the + to expand the <strong>DNSBL Whitelist</strong>, and paste the contents of that file at the end of that list. Don&rsquo;t forget to Save when you&rsquo;re done!</p></p></div><p>When you&rsquo;re done tweaking your feeds and everything, you can either wait for the cron update, or you can do it manually to get it to happen right away. Head to the <strong>Update</strong> tab, and you&rsquo;ll see a page like this.</p></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/pfblockerng-update.png></div><div class=main-content-wrap><p>Note the warning about avoiding conflicts with the cron job. If the red timer is under 5 minutes, avoid running a manual update, as it may break things. Anyway, click <span class="highlight-text primary">Run</span>, and you&rsquo;ll see the same updating logs that we saw during the initial install wizard.</p><h2 id=exploring-the-settings>Exploring the settings</h2><blockquote class=pullquote><p>We added the feeds from the list, and we enabled the Unbound blocking for them already! I thought we were good to go! There's more?</p></blockquote><p>Well, technically, we are done. But since pfBlockerNG is a bit of a steep learning curve, let&rsquo;s explore a bit, so we can get a bit more familiar with how to handle things.</p><p>For the most part, you won&rsquo;t <em>really</em> need to touch anything else in here, apart from what we&rsquo;ve configured already, to get things to work. There&rsquo;s a lot of settings to poke at to tweak things, so let&rsquo;s see what some of these more noteworthy settings are.</p><h3 id=general>General</h3></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/settings-general.png></div><div class=main-content-wrap><p>The general settings let you configure the basics of how pfBlockerNG works. For the most part, you should have to touch these. The default CRON interval of every hour is fine for most people, but if you want to update less frequently, you can change that. You can also choose to change the time it updates if you don&rsquo;t want it updating right on the hour.</p><p>Below that, the log settings let you change the line counts for each of the logs. The defaults are perfectly fine.</p><h3 id=ip>IP</h3></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/settings-ip.png></div><div class=main-content-wrap><p>Here, we can update the IP configuration settings like placeholders. The defaults should be fine. There&rsquo;s also a section for Geo IP blocking. If you have a MaxMind license key, this is where you&rsquo;d put it to let you do IP blocking based on location.</p><h3 id=dnsbl>DNSBL</h3></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/settings-dnsbl.png></div><div class=main-content-wrap><p>Since we&rsquo;re replacing Pi-hole here, this is one of the couple of pages that&rsquo;s really relevant here. For our DNS blocking, we need DNSBL always to be enabled.</p><p>I&rsquo;ve changed my virtual IP from the default of 10.10.10.1, since I have another connected remote site that uses this IP range, but the default is probably fine for you. If it&rsquo;s not, you can change it here, if you didn&rsquo;t already change it from the default during the setup wizard.</p><p>Below the web server configuration, there&rsquo;s options to configure firewall rules for DNSBL for allowing web server access. The defaults should be fine for most people.</p><p>The part to pay attention to here is the <strong>DNSBL Whitelist</strong> section. If you ever need to manually whitelist something, and either can&rsquo;t find it in the reports, or are just adding things in bulk, you can click the + to expand this list, and add whatever domains you want as new lines to the whitelist.</p><h3 id=dnsbl--dnsbl-groups>DNSBL > DNSBL Groups</h3></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/settings-dnsbl-groups.png></div><div class=main-content-wrap><p>Here, you can change your group order by dragging and dropping, and you can tweak some settings for the groups right there. If you need to edit a group you have already, you can also click the pencil to edit a group, or the trash can to delete it.</p><h3 id=update>Update</h3><p>The update section, we&rsquo;re already fairly familiar with. As stated before, you&rsquo;ll want to avoid manual updates when the CRON updates are about to run, or while they&rsquo;re running. Normally, this happens automatically, but if you changed the block lists, and need to force an update, this is where you&rsquo;d do that.</p><h3 id=reports>Reports</h3></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/settings-reports-alerts.png></div><div class=main-content-wrap><p>The default tab here is the <strong>Alerts</strong> tab, which gives you reports about what&rsquo;s been blocked (as long as the logging hasn&rsquo;t been turned off in the group settings for a blocklist group, that is). If you need to whitelist a domain, this is generally the place to find it. If something isn&rsquo;t quite working right, you can click the + on the offending item in the <strong>DNSBL</strong> section here, and it&rsquo;ll whitelist that domain.</p><h3 id=reports--dnsbl-stats>Reports > DNSBL Stats</h3></div><div class="figure figure--fullWidth"><img class=figure-img src=https://blog.flippedbits.io/img/posts/2020/07/wrangling-dns-pt-03-pfblockerng/settings-reports-dnsblstats.png></div><div class=main-content-wrap><p>This is where you go if you want pretty graphs and charts as to what&rsquo;s being blocked. There&rsquo;s a lot of ways this can be broken down, by blocked domains, by group size, top blocked groups, top feeds, etc. The list goes on, and there&rsquo;s a lot of info you can find here.</p><h2 id=cleaning-up>Cleaning up</h2><div class="alert warning"><p>pfBlockerNG is all set up now. Just a fair warning, as you&rsquo;ve seen, it&rsquo;s not nearly as plug and play as Pi-hole. And if you&rsquo;re using the DNSBL lists to replace Pi-hole, because there&rsquo;s a lot more lists, and some of them can be more or less aggressive, you&rsquo;ll have to be prepared to occasionally whitelist or tweak some things. Pi-hole worked so flawlessly because the blocklists were less aggressive, so keep that in mind!</p></div><p>Okay, so pfBlockerNG is all set up, and ready to go! We just have some last minute cleanup to do, since we&rsquo;re replacing Pi-hole.</p><p>All of the clients on the network, in my case, anyway, are using Pi-hole as primary, and pfSense as secondary DNS. If you want to get technical, since Pi-hole forwards to pfSense, we don&rsquo;t strictly <em>need</em> to fix anything. Since our aim is to replace Pi-hole, and clean up the hopping across the network, we can remove the extra step, and just have clients over DHCP use pfSense instead.</p><p>To do this, you&rsquo;ll have to tweak your DHCP settings, and if you have static clients that were assigned Pi-hole for DNS, you&rsquo;ll have to change those too.</p><p>Once that&rsquo;s done, you can safely kill whatever hardware or VM you&rsquo;re running Pi-hole on, and you should be all set!</p><p>Believe me, I know this was a long one, but you gain a ton of flexibility by making the switch.</p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i><span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-2-forcing-pfsense-dns/ data-tooltip="Wrangling DNS on Your Network, Part 2: Forcing pfSense DNS"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://plus.google.com/share?url=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><i class="fa fa-google-plus"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#><i class="fa fa-list"></i></a></li></ul></div></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2020 Andy Yasger. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i><span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-2-forcing-pfsense-dns/ data-tooltip="Wrangling DNS on Your Network, Part 2: Forcing pfSense DNS"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://plus.google.com/share?url=https://blog.flippedbits.io/2020/07/wrangling-dns-on-your-network-part-3-pfblockerng/"><i class="fa fa-google-plus"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#><i class="fa fa-list"></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fa fa-close"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.flippedbits.io%2F2020%2F07%2Fwrangling-dns-on-your-network-part-3-pfblockerng%2F"><i class="fa fa-facebook-official"></i><span>Share on Facebook</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fblog.flippedbits.io%2F2020%2F07%2Fwrangling-dns-on-your-network-part-3-pfblockerng%2F"><i class="fa fa-twitter"></i><span>Share on Twitter</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://plus.google.com/share?url=https%3A%2F%2Fblog.flippedbits.io%2F2020%2F07%2Fwrangling-dns-on-your-network-part-3-pfblockerng%2F"><i class="fa fa-google-plus"></i><span>Share on Google+</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-remove"></i></div><img id=about-card-picture src=https://blog.flippedbits.io/img/profile.jpg alt="Author's picture"><h4 id=about-card-name>Andy Yasger</h4><div id=about-card-bio>&ldquo;My documentation is <em><strong>in</strong></em> the code!&rdquo;</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>Homelabber and IT enthusiast</div><div id=about-card-location><i class="fa fa-map-marker"></i><br>United States</div></div></div><div id=cover style=background-image:url(https://blog.flippedbits.io/img/side-banner.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin=anonymous></script><script src=https://blog.flippedbits.io/js/script-r1pwetvjpsxhew1tzs9njeug7ah8cyirkcfplwsbn717kxdjshsmropnl.min.js></script><script lang=javascript>window.onload=updateMinWidth;window.onresize=updateMinWidth;document.getElementById("sidebar").addEventListener("transitionend",updateMinWidth);function updateMinWidth(){var sidebar=document.getElementById("sidebar");var main=document.getElementById("main");main.style.minWidth="";var w1=getComputedStyle(main).getPropertyValue("min-width");var w2=getComputedStyle(sidebar).getPropertyValue("width");var w3=getComputedStyle(sidebar).getPropertyValue("left");main.style.minWidth=`calc(${w1} - ${w2} - ${w3})`;}</script><script>$(document).ready(function(){hljs.configure({classPrefix:'',useBR:false});$('pre.code-highlight > code, pre > code').each(function(i,block){if(!$(this).hasClass('codeblock')){$(this).addClass('codeblock');}
hljs.highlightBlock(block);});});</script></body></html>